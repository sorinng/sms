<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ê°€ì¥ ì‰¬ìš´ ë¬¸ì ë³´ë‚´ê¸°</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
body {
  font-family: "Pretendard", "Malgun Gothic", sans-serif;
}
</style>
</head>

<body class="bg-gray-100 min-h-screen p-4">

<div class="max-w-3xl mx-auto bg-white shadow-xl rounded-xl p-6">

  <h1 class="text-3xl font-extrabold text-center mb-6">ğŸ“± ê°€ì¥ ì‰¬ìš´ ë¬¸ì ë³´ë‚´ê¸°1</h1>

  <!-- PC ì…ë ¥ ì˜ì—­ -->
  <div id="inputArea">

    <div class="grid grid-cols-2 gap-4 mb-6">

      <div>
        <h2 class="font-semibold mb-1">í•¸ë“œí° ë²ˆí˜¸ (<span id="phoneCount">0</span>ê°œ)</h2>
        <textarea id="phoneInput"
          class="w-full h-32 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
          placeholder="01011112222&#10;01033334444"></textarea>
      </div>

      <div>
        <h2 class="font-semibold mb-1">ë¬¸ìë‚´ìš© (<span id="msgCount">0</span>ê°œ)</h2>
        <textarea id="msgInput"
          class="w-full h-32 p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
          placeholder="ì•ˆë…•í•˜ì„¸ìš”&#10;ë©”ì‹œì§€ì…ë‹ˆë‹¤"></textarea>
      </div>

    </div>

    <button id="makeQR"
      class="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg shadow-lg text-lg font-semibold mb-6">
      QR ì½”ë“œ ìƒì„± (ë²ˆí˜¸/ë¬¸ì í¬í•¨)
    </button>

    <div id="qrArea" class="my-6 text-center"></div>
  </div>

  <!-- ëª¨ë°”ì¼ ìë™ ë²„íŠ¼ ì˜ì—­ -->
  <div id="sendButtons" class="space-y-3"></div>

  <div class="mt-8 p-4 bg-gray-100 rounded-xl text-sm leading-relaxed">
    ğŸ“Œ ìŠ¤ë§ˆíŠ¸í°ì—ì„œëŠ” <b>QRë¡œ ì ‘ì†</b>í•˜ë©´ ë²ˆí˜¸Â·ë¬¸ìê°€ ìë™ ì…ë ¥ë˜ê³   
    ì‚¬ëŒë³„ ë³´ë‚´ê¸° ë²„íŠ¼ì´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
  </div>

</div>


<script>
// -----------------------------
// ì¤„ ê°œìˆ˜
// -----------------------------
function countLines(text) {
  return text.split("\n").filter(v => v.trim()).length;
}

function updateCounts() {
  phoneCount.innerText = countLines(phoneInput.value);
  msgCount.innerText   = countLines(msgInput.value);
}

phoneInput.addEventListener("input", updateCounts);
msgInput.addEventListener("input", updateCounts);


// -----------------------------
// URL íŒŒë¼ë¯¸í„° ì½ê¸°
// -----------------------------
function getParam(name) {
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}


// -----------------------------
// ë²„íŠ¼ ìƒì„± í•¨ìˆ˜
// -----------------------------
function createSendButtons(phones, msgs) {

  const area = document.getElementById("sendButtons");
  area.innerHTML = "";

  phones.forEach((p, i) => {
    const msg = msgs[i];

    const btn = document.createElement("button");
    btn.className =
      "w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg shadow text-lg font-semibold";
    btn.innerHTML = `[${i+1}] ${p} â†’ ë³´ë‚´ê¸°`;

    btn.onclick = () => {
      const smsURL = `sms:${p}?body=${encodeURIComponent(msg)}`;
      window.location.href = smsURL;
      btn.style.display = "none";
    };

    area.appendChild(btn);
  });
}


// -----------------------------
// QR ìƒì„± (ë²ˆí˜¸Â·ë¬¸ì í¬í•¨ URL ìƒì„±)
// -----------------------------
document.getElementById("makeQR").onclick = () => {

  const phones = phoneInput.value.split("\n").map(v => v.trim()).filter(v=>v);
  const msgs   = msgInput.value.split("\n").map(v => v.trim()).filter(v=>v);

  if (phones.length === 0 || msgs.length === 0) {
    alert("ë²ˆí˜¸ì™€ ë¬¸ìë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  // ë©”ì‹œì§€ ê°œìˆ˜ê°€ ë‹¤ë¥´ë©´ ì•„ì£¼ë°©ì²˜ëŸ¼ ì²˜ë¦¬
  if (phones.length !== msgs.length) {
    const isSame = confirm(
      "ë™ì¼ ë©”ì‹œì§€ë¥¼ ë°˜ë³µí•´ì„œ ë³´ë‚´ì‹œë ¤ë©´ 'í™•ì¸'.\në²ˆí˜¸ë³„ ê°œë³„ ë¬¸ìë¥¼ ë³´ë‚´ë ¤ë©´ 'ì·¨ì†Œ'."
    );

    if (isSame) {
      const msg = msgs[0];
      msgs.length = 0;
      phones.forEach(() => msgs.push(msg));
    } else {
      if (msgs.length !== phones.length) {
        alert("ê°œë³„ ë°œì†¡ì€ ë²ˆí˜¸ ìˆ˜ì™€ ë©”ì‹œì§€ ìˆ˜ê°€ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.");
        return;
      }
    }
  }

  // URL íŒŒë¼ë¯¸í„° ì¸ì½”ë”©
  const pParam = encodeURIComponent(phones.join(","));
  const mParam = encodeURIComponent(msgs.join("||"));

  const finalURL = `https://sorinng.github.io/sms/?p=${pParam}&m=${mParam}`;

  // QR ìƒì„±
  const qrDiv = document.getElementById("qrArea");
  qrDiv.innerHTML = `
    <h3 class="text-lg font-semibold mb-3">ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ QRì„ ìŠ¤ìº”í•˜ì„¸ìš”</h3>
    <div id="qrcode"></div>
  `;

  new QRCode(document.getElementById("qrcode"), {
    text: finalURL,
    width: 220,
    height: 220
  });

};


// -----------------------------
// ëª¨ë°”ì¼ ì ‘ì† ì‹œ ìë™ ë²„íŠ¼ ìƒì„±
// -----------------------------
window.addEventListener("DOMContentLoaded", () => {

  const p = getParam("p");
  const m = getParam("m");

  if (!p || !m) return;

  // PC ì…ë ¥ ì˜ì—­ ìˆ¨ê¸°ê¸°
  document.getElementById("inputArea").style.display = "none";

  const phones = decodeURIComponent(p).split(",");
  const msgs   = decodeURIComponent(m).split("||");

  createSendButtons(phones, msgs);
});
</script>

</body>
</html>
