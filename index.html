<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ“± ë¬¸ì ë³´ë‚´ê¸° ğŸ“±</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
body { background:#f4f4f4; font-family:"Pretendard","Malgun Gothic",sans-serif; font-size:20px; }
.card { background:white; padding:30px; border-radius:20px; box-shadow:0 4px 20px rgba(0,0,0,0.1); text-align:center; }

.label { font-size:26px; font-weight:700; color:#333; margin-bottom:10px; text-align:center; }

.input-box {
  width:50%;
  border:1px solid #ddd;
  border-radius:12px;
  padding:18px;
  font-size:20px;
  margin:auto;
  display:block;
}

/* ğŸ“Œ ë²„íŠ¼ ìƒ‰ìƒ */
.big-btn {
  width:50%;
  background:#C9B6E4;
  color:white;
  padding:20px;
  font-size:24px;
  border-radius:14px;
  font-weight:700;
  margin:auto;
  display:block;
}
.big-btn:hover { background:#B39CD0; }

.qr-title { font-size:22px; font-weight:800; margin-bottom:14px; text-align:center; }
.hidden-area { display:none; }

#qrcode { margin:auto; }

/* ëª¨ë°”ì¼ ì „ì†¡ ë²„íŠ¼ */
#sendButtons button {
  font-size:40px;
  padding:40px;
  border-radius:30px;
  width:100%;
}
</style>
</head>

<body class="p-5 flex justify-center items-center">

<div class="max-w-3xl w-full mx-auto card">

<h1 class="text-4xl font-extrabold mb-10 text-center">ğŸ“± ë¬¸ì ë³´ë‚´ê¸° ğŸ“±</h1>

<div id="inputArea">

<div class="mb-14">
  <div class="label">í•¸ë“œí° ë²ˆí˜¸ (<span id="phoneCount">0</span>ê°œ)</div>
  <textarea id="phoneInput" class="input-box h-36" placeholder="01012345678&#10;01098765432"></textarea>
</div>

<div class="mb-16">
  <div class="label">ë¬¸ìë‚´ìš©</div>
  <textarea id="msgInput" class="input-box h-40" placeholder="ì•ˆë…•í•˜ì„¸ìš”. ë¬¸ì ë°œì†¡ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤."></textarea>
</div>

<div class="mb-16">
  <button id="makeQR" class="big-btn">QR ì½”ë“œ ìƒì„±</button>
</div>

<div id="qrArea" class="text-center mt-10"></div>

</div>

<div id="sendButtons" class="space-y-10 mt-12"></div>

<div class="mt-12 text-gray-700 text-lg leading-relaxed">
  ìŠ¤ë§ˆíŠ¸í°ì—ì„œ QRì„ ìŠ¤ìº”í•˜ë©´ ë²ˆí˜¸Â·ë¬¸ìê°€ ìë™ ì…ë ¥ë˜ê³ <br>
  ì‚¬ëŒë³„ ë³´ë‚´ê¸° ë²„íŠ¼ì´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
</div>

</div>

<script>

// í•¸ë“œí° ê°œìˆ˜ ì¹´ìš´íŠ¸
function countLines(t){ return t.split("\n").filter(v=>v.trim()).length; }
function updateCounts(){ phoneCount.innerText = countLines(phoneInput.value); }
phoneInput.addEventListener("input", updateCounts);


// QR ì½”ë“œ ìƒì„±
document.getElementById("makeQR").onclick = () => {

  const phones = phoneInput.value
    .split("\n")
    .map(v=>v.trim())
    .filter(v=>v);

  let msg = msgInput.value;

  // ğŸ“Œ ë©”ì‹œì§€ ë¹„ì–´ìˆì„ ë•Œ ë°©ì§€
  if(!msg || msg.trim().length === 0){
    alert("ë¬¸ì ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  // ğŸ“Œ ì—¬ëŸ¬ ì¤„ ë©”ì‹œì§€ë¥¼ QRì—ì„œ ì•ˆì „í•˜ê²Œ ì „ì†¡í•˜ë„ë¡ ë³€í™˜
  msg = msg.replace(/\r?\n/g, "<br>");

  if(phones.length === 0){
    alert("ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  // ë²ˆí˜¸ ê°œìˆ˜ë§Œí¼ ë™ì¼í•œ ë©”ì‹œì§€ ë³µì œ
  const msgs = phones.map(()=>msg);

  const pParam = encodeURIComponent(phones.join(","));
  const mParam = encodeURIComponent(msgs.join("||"));

  const finalURL = `https://sorinng.github.io/sms/?p=${pParam}&m=${mParam}`;

  // ğŸ“Œ QR ì¤‘ì•™ì •ë ¬
  const qrDiv = document.getElementById("qrArea");
  qrDiv.innerHTML = `
    <div class="qr-title">QR ì½”ë“œë¡œ ì ‘ì†í•˜ì„¸ìš”</div>
    <div class="flex justify-center">
      <div id="qrcode"></div>
    </div>
  `;

  new QRCode(document.getElementById("qrcode"), {
    text: finalURL,
    width: 260,
    height: 260
  });
};


// URL íŒŒë¼ë¯¸í„° ì½ê¸°
function getParam(name){
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}


// ëª¨ë°”ì¼ì—ì„œ ì‹¤ì œ ë¬¸ì ë³´ë‚´ê¸° ë²„íŠ¼ ìƒì„±
function createSendButtons(phones,msgs){
  const area = document.getElementById("sendButtons");
  area.innerHTML="";

  phones.forEach((p,i)=>{
    const msg = msgs[i].replace(/<br>/g, "\n");  // â† ì¤„ë°”ê¿ˆ ë³µì›

    const btn=document.createElement("button");
    btn.className="big-btn";
    btn.style.width = "100%";
    btn.innerHTML=`ğŸ“¨ [${i+1}] ${p} â†’ ë¬¸ì ë³´ë‚´ê¸°`;

    btn.onclick=()=>{
      const smsURL=`sms:${p}?body=${encodeURIComponent(msg)}`;
      window.location.href=smsURL;
      btn.style.display="none";
    };

    area.appendChild(btn);
  });
}


// QRì„ í†µí•´ ì ‘ì†í•œ ê²½ìš° ë™ì‘
window.addEventListener("DOMContentLoaded",()=>{
  const p=getParam("p");
  const m=getParam("m");

  if(!p||!m) return;

  // ì…ë ¥ì˜ì—­ ìˆ¨ê¹€
  document.getElementById("inputArea").classList.add("hidden-area");

  const phones=decodeURIComponent(p).split(",");
  const msgs=decodeURIComponent(m).split("||");

  createSendButtons(phones,msgs);
});

</script>

</body>
</html>
